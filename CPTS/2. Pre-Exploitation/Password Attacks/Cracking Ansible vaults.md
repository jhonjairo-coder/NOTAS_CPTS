
# **¿Qué es Ansible Vault?**

**Ansible Vault es una funcionalidad de Ansible que permite cifrar información sensible**, como contraseñas, claves API, certificados, archivos completos o variables dentro de un playbook.

Su propósito principal es **proteger información confidencial** dentro de proyectos de automatización y despliegue, especialmente cuando dichos archivos se almacenan en repositorios como Git.

En otras palabras:

> **Ansible Vault sirve para que puedas subir tus playbooks a Git sin exponer contraseñas en texto plano.**

``` shell
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ cat main.yml 
---
pwm_run_dir: "{{ lookup('env', 'PWD') }}"

pwm_hostname: authority.htb.corp
pwm_http_port: "{{ http_port }}"
pwm_https_port: "{{ https_port }}"
pwm_https_enable: true

pwm_require_ssl: false

pwm_admin_login: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32666534386435366537653136663731633138616264323230383566333966346662313161326239
          6134353663663462373265633832356663356239383039640a346431373431666433343434366139
          35653634376333666234613466396534343030656165396464323564373334616262613439343033
          6334326263326364380a653034313733326639323433626130343834663538326439636232306531
          3438

pwm_admin_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31356338343963323063373435363261323563393235633365356134616261666433393263373736
          3335616263326464633832376261306131303337653964350a363663623132353136346631396662
          38656432323830393339336231373637303535613636646561653637386634613862316638353530
          3930356637306461350a316466663037303037653761323565343338653934646533663365363035
          6531

ldap_uri: ldap://127.0.0.1/
ldap_base_dn: "DC=authority,DC=htb"
ldap_admin_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63303831303534303266356462373731393561313363313038376166336536666232626461653630
          3437333035366235613437373733316635313530326639330a643034623530623439616136363563
          34646237336164356438383034623462323531316333623135383134656263663266653938333334
          3238343230333633350a646664396565633037333431626163306531336336326665316430613566
          3764                                     
```

 ```
 sed -i 's/^[ \t]*//' main.yml 
```

```shell
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ cat main.yml 
---
pwm_run_dir: "{{ lookup('env', 'PWD') }}"

pwm_hostname: authority.htb.corp
pwm_http_port: "{{ http_port }}"
pwm_https_port: "{{ https_port }}"
pwm_https_enable: true

pwm_require_ssl: false

pwm_admin_login: !vault |
$ANSIBLE_VAULT;1.1;AES256
32666534386435366537653136663731633138616264323230383566333966346662313161326239
6134353663663462373265633832356663356239383039640a346431373431666433343434366139
35653634376333666234613466396534343030656165396464323564373334616262613439343033
6334326263326364380a653034313733326639323433626130343834663538326439636232306531
3438

pwm_admin_password: !vault |
$ANSIBLE_VAULT;1.1;AES256
31356338343963323063373435363261323563393235633365356134616261666433393263373736
3335616263326464633832376261306131303337653964350a363663623132353136346631396662
38656432323830393339336231373637303535613636646561653637386634613862316638353530
3930356637306461350a316466663037303037653761323565343338653934646533663365363035
6531

ldap_uri: ldap://127.0.0.1/
ldap_base_dn: "DC=authority,DC=htb"
ldap_admin_password: !vault |
$ANSIBLE_VAULT;1.1;AES256
63303831303534303266356462373731393561313363313038376166336536666232626461653630
3437333035366235613437373733316635313530326639330a643034623530623439616136363563
34646237336164356438383034623462323531316333623135383134656263663266653938333334
3238343230333633350a646664396565633037333431626163306531336336326665316430613566
3764
```

```shell
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ vi vaul_01 
                                                                                                                                                                                                   
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ vi vaul_02
                                                                                                                                                                                                   
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ vi vaul_03
                                                                                                                                                                                                   
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible2john vaul_01
vaul_01:$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8
                                                                                                                                                                                                   
┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible2john vaul_02
vaul_02:$ansible$0*0*15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5*1dff07007e7a25e438e94de3f3e605e1*66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5

┌──(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible2john vaul_03
vaul_03:$ansible$0*0*c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93*dfd9eec07341bac0e13c62fe1d0a5f7d*d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635
```

```shell
──(kali㉿kali)-[~/machines/Authority/content]
└─$ hashcat --example-hashes | grep -i ansible -B5              

  Potfile.Enabled.....: No
  Custom.Plugin.......: No
  Plaintext.Encoding..: ASCII, HEX

Hash mode #16900
  Name................: Ansible Vault
--
  Salt.Type...........: Embedded
  Salt.Len.Min........: 0
  Salt.Len.Max........: 256
  Kernel.Type(s)......: pure
  Example.Hash.Format.: plain
  Example.Hash........: $ansible$0*0*6b761adc6faeb0cc0bf197d3d4a4a7d3f1682e4b169cae8fa6b459b3214ed41e*426d313c5809d4a80a4b9bc7d4823070*d8bad190c7fbc7c3cb1c60a27abfb0ff59d6fb73178681c7454d94a0f56a4360
```

```shell
──(kali㉿kali)-[~/machines/Authority/content]
└─$ hashcat -m 16900 hashes /usr/share/wordlists/rockyou.txt  
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, SPIR-V, LLVM 18.1.8, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
====================================================================================================================================================
* Device #1: cpu-sandybridge-AMD Ryzen 5 8500G w/ Radeon 740M Graphics, 6939/13942 MB (2048 MB allocatable), 8MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 3 digests; 3 unique digests, 3 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Slow-Hash-SIMD-LOOP

Watchdog: Temperature abort trigger set to 90c

INFO: Removed hash found as potfile entry.

Host memory required for this attack: 2 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

Cracking performance lower than expected?                 

* Append -w 3 to the commandline.
  This can cause your screen to lag.

* Append -S to the commandline.
  This has a drastic speed impact but can be better for specific attacks.
  Typical scenarios are a small wordlist but a large ruleset.

* Update your backend API runtime / driver the right way:
  https://hashcat.net/faq/wrongdriver

* Create more work items to make use of your parallelization power:
  https://hashcat.net/faq/morework

$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8:!@#$%^&*
$ansible$0*0*c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93*dfd9eec07341bac0e13c62fe1d0a5f7d*d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635:!@#$%^&*
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 16900 (Ansible Vault)
Hash.Target......: hashes
Time.Started.....: Sat Dec  6 11:13:42 2025 (20 secs)
Time.Estimated...: Sat Dec  6 11:14:02 2025 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:     3944 H/s (6.17ms) @ Accel:32 Loops:1024 Thr:1 Vec:8
Recovered........: 3/3 (100.00%) Digests (total), 2/3 (66.67%) Digests (new), 3/3 (100.00%) Salts
Progress.........: 119808/43033155 (0.28%)
Rejected.........: 0/119808 (0.00%)
Restore.Point....: 39680/14344385 (0.28%)
Restore.Sub.#1...: Salt:2 Amplifier:0-1 Iteration:9216-9999
Candidate.Engine.: Device Generator
Candidates.#1....: 112500 -> prospect
Hardware.Mon.#1..: Util: 81%

Started: Sat Dec  6 11:13:41 2025
Stopped: Sat Dec  6 11:14:04 2025
```

```shell
virtualenv ansible  
source ansible/bin/activate
pip install ansible-vault
```

```shell
┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible-vault decrypt vaul_01
Vault password: 
Decryption successful
                                                            
┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ cat vaul_01
svc_pwm                                                                                                                                                                       
┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible-vault decrypt vaul_02
Vault password: 
Decryption successful

┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ ansible-vault decrypt vaul_03
Vault password: 
Decryption successful

┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ cat vaul_02
pWm_@dm!N_!23                                                                                                                                                                           
┌──(ansible)─(kali㉿kali)-[~/machines/Authority/content]
└─$ cat vaul_03
DevT3st@123       

